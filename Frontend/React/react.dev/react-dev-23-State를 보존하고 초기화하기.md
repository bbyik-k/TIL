# React.dev-docs-23-State를 보존하고 초기화하기

[REACT 학습하기 > STATE 관리하기 > State를 보존하고 초기화하기](https://ko.react.dev/learn/preserving-and-resetting-state)

## Goal

각 컴포넌트는 독립된 state를 가짐.  
 React는 UI 트리에서의 **_위치를 통해_** 각 state가 어떤 컴포넌트에 속하는지 추적.  
 리렌더링마다 언제 state를 보존하고 또 state를 초기화할지 컨트롤할 수 있음.

- React가 언제 state를 보존하고 언제 초기화하는지
- 어떻게 React가 컴포넌트의 state를 초기화하도록 강제할 수 있는지
- key와 타입이 state 보존에 어떻게 영향을 주는지

## State는 렌더 트리의 위치에 연결됩니다

- state는 컴포넌트 내부에 저장되지 않고, React 내부에서 **UI 트리 위치에 연결**되어 관리된다.
- React는 컴포넌트의 위치를 기준으로 state를 연결하며, 해당 컴포넌트가 제거되면 state도 함께 제거된다.
- 따라서 컴포넌트가 같은 자리에 렌더링되는 한, state는 보존된다.

## 같은 자리의 같은 컴포넌트는 state를 보존합니다

- 같은 위치에서 동일한 컴포넌트 타입이 렌더링된다면, props가 변하더라도 state는 유지된다.
- React는 마크업(JSX)보다는 UI 트리의 구조와 위치를 기준으로 state를 관리한다.

> **주의하세요!**
>
> React는 JSX 마크업에 관심이 있는 것이 아니라 UI 트리의 위치에 관심이 있다.
>
> 따라서 동일한 위치의 동일한 컴포넌트는 옵션이나 props가 달라져도 state를 유지한다.

## 같은 위치의 다른 컴포넌트는 state를 초기화합니다

- 같은 위치에서 다른 컴포넌트 타입으로 교체하면, 기존 컴포넌트와 그 state가 제거되고 새 컴포넌트가 초기화된다.
- 구조 변경(`div` → `section`) 등으로 상위 요소가 달라지면, 하위 컴포넌트의 state까지 초기화될 수 있다.

> **주의하세요!**
>
> 컴포넌트를 중첩 정의하면, 부모가 리렌더링될 때마다 새로운 하위 컴포넌트 함수가 생성된다.
>
> 이 경우 React는 매번 새로운 컴포넌트로 인식하여 state를 초기화하므로 **중첩 정의를 피해야 한다.**

## 같은 위치에서 state를 초기화하기

### 선택지 1: 다른 위치에 컴포넌트를 렌더링하기

```jsx
{
  isPlayerA && <Counter person='Taylor' />;
}
{
  !isPlayerA && <Counter person='Sarah' />;
}
```

- 특정 위치의 컴포넌트를 제거하고, 다른 위치에서 렌더링하면 state가 초기화된다.

### 선택지 2: key를 이용해 state를 초기화하기

```jsx
{
  isPlayerA ? ( //
    <Counter key='Taylor' person='Taylor' />
  ) : (
    //
    <Counter key='Sarah' person='Sarah' />
  );
}
```

- key를 명시적으로 제공하면 React는 해당 key를 위치 식별자로 사용한다.
- 따라서 같은 위치여도 key가 다르면 서로 다른 컴포넌트로 인식되어 state가 초기화된다.

### key를 이용해 폼을 초기화하기

- key 기반 초기화는 폼 데이터 초기화에 유용하다.
- 예: 메시지 대상이 바뀔 때, 새 대상에 맞게 입력창의 state를 초기화 가능하다.

> **제거된 컴포넌트의 state를 보존하기**
>
> 제거되는 대신, CSS로 가려서 state를 보존할 수 있다.
>
> 하지만 숨겨진 DOM이 많으면 성능 저하 가능성이 있다.
>
> 일반적 해결책은 state를 상위 컴포넌트로 끌어올리거나, `localStorage` 등 외부 저장소에 두는 것이다.

## 요약

- React는 같은 컴포넌트가 같은 위치에 렌더링되는 한 state를 유지한다.
- state는 JSX 태그에 저장되지 않고, UI 트리의 위치와 연결된다.
- 다른 컴포넌트 타입으로 교체되거나 key가 달라지면 state는 초기화된다.
- 컴포넌트를 중첩 정의하면 불필요하게 state가 초기화되므로 피해야 한다.

## 인사이트

- state는 “컴포넌트 내부에 있는 값”이 아니라 React가 UI 트리에서 컴포넌트를 식별하고 연결해 관리하는 값이라는 점. 동작 매커니즘에서 늘 이해하고 적용해야 한다.
- UI 트리의 위치와 `key`가 `state` 보존 여부를 결정한다는 원리를 적용하여, 불필요한 state 손실을 방지하자.
- key를 활용하면 의도적으로 state를 초기화할 수 있으며, 이는 폼 초기화나 사용자 전환 시나리오에서 매우 유용.
- 반대로 중첩된 정의나 불필요한 구조 변경은 원치 않는 state 초기화를 유발하므로 설계 단계에서 피할 것.
