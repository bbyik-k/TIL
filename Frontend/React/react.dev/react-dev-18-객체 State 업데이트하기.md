# React.dev-docs-18-객체 State 업데이트하기

[REACT 학습하기 > 상호작용성 더하기 > 객체 State 업데이트하기](https://ko.react.dev/learn/updating-objects-in-state)

## Goal

State는 객체를 포함한 모든 종류의 자바스크립트 값을 가질 수 있음.

지만 React state가 가진 객체를 직접 변경해서는 안 됨. !! 중요

객체를 업데이트하고 싶을 때는 새로운 객체를 생성하여 (또는 기존 객체의 복사본을 만들어), state가 복사본을 사용하도록 해야한다.

- React state에서 객체를 올바르게 업데이트하는 방법
- 중첩된 객체를 변경하지 않고 업데이트하는 방법
- 불변성이란 무엇인지, 그리고 불변성을 지키는 방법
- Immer로 반복을 줄여 객체를 복사하는 방법

## 변경이란?

- “변경한다”는 것은 **기존 객체를 수정**하는 것을 의미한다.
- 예시:

```js
obj.x = 5; // 기존 객체 수정 → 변경
```

- React state는 이러한 변경을 감지하지 못하므로 렌더링이 발생하지 않는다.

## State를 읽기 전용인 것처럼 다루세요

- state 객체는 마치 “**_읽기 전용_**”으로 취급해야 한다.
- state를 직접 바꾸는 대신 새로운 객체를 만들어 교체해야 한다.
  - 직접 변경 시 이전 렌더의 state 변경 - set을 통해 변경하기

> **지역 변경은 괜찮습니다**
>
> 함수 내부에서 만든 지역 변수나 임시 객체는 자유롭게 수정 가능하다.
>
> 단, state로 관리되는 값은 직접 수정해서는 안 된다.

## 전개 문법으로 객체 복사하기

- 새로운 객체를 생성할 때 전개 연산자(...)를 활용할 수 있다.
  - 얕은 복사
- 예시:

```js
setPerson({
  ...person,
  age: person.age + 1,
});
```

- 전개 문법은 얕은 복사만 수행하므로, 중첩된 객체에서는 더 깊은 단계까지 복사해야 한다.

> **여러 필드에 단일 이벤트 핸들러 사용하기**
>
> 전개 문법을 사용하면 여러 필드를 한 번에 업데이트하는 로직을 간결하게 작성할 수 있다.

## 중첩된 객체 갱신하기

- 중첩된 객체를 수정할 때는 필요한 부분부터 복사해 나가야 한다.
- 예시:

  ```js
  setPerson({
    ...person,
    address: {
      ...person.address,
      city: 'Seoul',
    },
  });
  ```

> **객체들은 사실 중첩되어 있지 않습니다**
>
> 중첩된 객체처럼 보이는 구조도 결국 메모리 상에서는 참조(reference)로 연결된 별도의 객체들이다.
>
> 따라서 중첩된 구조를 안전하게 수정하려면 각 단계마다 새 객체를 만들어야 한다.

## Immer로 간결한 갱신 로직 작성하기

- Immer는 불변성 관리를 단순화하는 라이브러리이다.
- produce API를 사용하면 state를 “변경하듯” 작성하더라도 내부적으로는 불변성을 지켜 새 객체를 반환한다.

  ```js
  import { useImmer } from 'use-immer';

  const [person, updatePerson] = useImmer(initialPerson);

  updatePerson((draft) => {
    draft.address.city = 'Seoul'; // 직접 변경하듯 작성
  });
  ```

> **Immer는 어떻게 작동할까요?**
>
> Immer는 **Proxy**를 활용해 변경 내역을 추적하고, 최종적으로 불변성을 지킨 새로운 객체를 생성한다.

> **왜 React에서 state 변경은 권장되지 않나요?**
>
> state를 직접 변경하면 React가 리렌더링을 감지하지 못한다.
> 이는 UI와 데이터 간의 불일치, 버그, 디버깅 어려움으로 이어질 수 있다.

## 요약

- React의 모든 state를 **불변한 것으로 대하세요**.
- state에 저장된 객체를 직접 변경하면 렌더링이 발생하지 않는다.
  - state에 객체를 저장할 때, 객체를 변경하는 것은 렌더링을 발생시키지 않으며 이전 렌더 “스냅샷”의 state를 바꿀 것입니다.
  - 객체를 변경하는 대신 새로운 객체를 생성하여 state를 설정함으로써 리렌더링을 일으키세요.
- 객체의 복사본을 만들기 위해 `{...obj, something: 'newValue'}` 객체 전개 구문을 사용할 수 있습니다.
- 전개 구문은 얕습니다. 그것은 **_한 레벨 깊이만 복사_**합니다.
- 중첩된 객체를 업데이트하기 위해서는 변경하는 부분에서부터 시작하여 객체의 모든 항목의 복사본을 만들어야 합니다.
- 반복적인 복사 코드를 줄이기 위해서 **Immer**를 사용하세요.

## 인사이트

- React에서 불변성을 지키는 것은 렌더링 모델의 핵심 전제.
  변경 감지와 최적화가 참조 비교(shallow equality)에 의존하기 때문이다.
- 전개 문법을 활용하면 객체 복사를 직관적으로 수행할 수 있지만, 중첩이 깊을수록 코드가 장황해진다.
  이때 Immer 같은 라이브러리가 실무에서 큰 도움을 준다.
  - Immer의 동작 방식은 **draft - proxy**
- 과거 Redux 학습 경험과 이어서 보면, React state 관리 역시 같은 불변성 원칙을 공유한다는 점이 흥미롭다.
  - 불변성 원칙은 react 전체의 모든 과정에 있어서 핵심 철학
- “객체를 변경하는 것”과 “새 객체를 만드는 것”의 차이를 명확히 이해하는 것이 React 상태 관리의 첫걸음일 것.
